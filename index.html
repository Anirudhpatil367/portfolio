<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anirudh Ashok Patil - Portfolio</title>
    <!-- Favicon -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <!-- AOS CSS for animations -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.1/dist/aos.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">Anirudh</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#about">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#skills">Skills</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#projects">Projects</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#experience">Experience</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#contact">Contact</a>
                    </li>
                    <!-- Resume Download Link -->
                    <li class="nav-item">
                        <a class="nav-link" href="Anirudh_Resume.pdf" download target="_blank">Download Resume</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="hero" class="bg-primary text-white text-center py-5" data-aos="fade-in">
        <div class="container">
            <h1 class="display-4">Hello, I'm Anirudh Ashok Patil</h1>
            <p class="lead">A passionate developer and problem solver.</p>
            <a href="#contact" class="btn btn-outline-light">Get In Touch</a>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="py-5" data-aos="fade-up">
        <div class="container">
            <div class="row">
                <div class="col-lg-6" data-aos="fade-right">
                    <img src="Images/Anirudh.JPG" alt="Your Photo" class="img-fluid square-image">
                </div>
                <div class="col-lg-6" data-aos="fade-left">
                    <h2>About Me</h2>
                    <p>Hello! I'm Anirudh, a Data Engineer passionate about building scalable data pipelines and solving complex data challenges. I have experience in ETL development, cloud platforms, and data processing to deliver actionable insights.</p>
                    <p>Feel free to browse my portfolio and get in touch if you'd like to collaborate or hire me for your next project!</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Skills Section with Percentage Loading Bars -->
    <section id="skills" class="bg-light py-5" data-aos="fade-up">
        <div class="container">
            <h2 class="text-center">Skills</h2>
            <div class="row text-center mt-4">
                <div class="col-md-4">
                    <h5>Python</h5>
                    <div class="progress">
                        <div class="progress-bar bg-success" role="progressbar" style="width: 94%" aria-valuenow="94" aria-valuemin="0" aria-valuemax="100">94%</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <h5>AWS</h5>
                    <div class="progress">
                        <div class="progress-bar bg-info" role="progressbar" style="width: 90%" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100">90%</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <h5>Data Science</h5>
                    <div class="progress">
                        <div class="progress-bar bg-warning" role="progressbar" style="width: 86%" aria-valuenow="86" aria-valuemin="0" aria-valuemax="100">86%</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <h5>SQL Server, Postgre Sql</h5>
                    <div class="progress">
                        <div class="progress-bar bg-warning" role="progressbar" style="width: 94%" aria-valuenow="94" aria-valuemin="0" aria-valuemax="100">94%</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <h5>Data Visualisation</h5>
                    <div class="progress">
                        <div class="progress-bar bg-warning" role="progressbar" style="width: 91%" aria-valuenow="91" aria-valuemin="0" aria-valuemax="100">91%</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Academic Experience Section -->
    <section id="experience" class="py-5" data-aos="fade-up">
        <div class="container">
            <h2 class="text-center">Academic Experience</h2>
            <div class="row mt-4">
                <div class="col-md-6" data-aos="fade-left" style="border-right: 1px solid #ccc; padding-right: 20px;">
                    <h5>Master of Science in Data Science</h5>
                    <p>University of Alabama At Birmingham, May 2025</p>
                    <p>Relevant coursework: Machine Learning, Big Data, Statistical Analysis</p>
                </div>
                <div class="col-md-6" data-aos="fade-right">
                    <h5>Bachelor of Science in Computer Science</h5>
                    <p>KLE Institute of Technology, Aug 2021</p>
                    <p>Relevant coursework: Web Development, Data Structures, Algorithms</p>
                </div>
            </div>
        </div>
    </section>

    <section id="work-experience" class="bg-light py-5" data-aos="fade-up">
        <div class="container">
          <h2 class="text-center">Work Experience</h2>
          <div class="row mt-4">
            
            <div class="col-md-6" data-aos="fade-right" style="border-right: 1px solid #ccc; padding-right: 20px;">
              <h5>Research Assistant | Research Technician | Data Engineer - University of Alabama at Birmingham</h5>
              <p>Oct 2024 - Present</p>
              <ul>
                <li>Promoted to Research Technician in July 2025 for contributions to ETL automation and data engineering.</li>
                <li>Built scalable ETL pipelines in Databricks using PySpark and AWS Glue, reducing gene-protein data processing time by 40%.</li>
                <li>Conducted statistical analysis using Pearson’s correlation and p-values, improving accuracy by 35% across gene samples.</li>
                <li>Designed modular storage pipelines for 10K+ new records/day, improving data retrieval performance by 30%.</li>
              </ul>
            </div>
            
            <div class="col-md-6" data-aos="fade-right" >
              <h5>Quality and Performance - Senior Associate | Data Engineer - NTT Data Information Private Limited</h5>
              <p>Feb 2022 - Aug 2024</p>
              <ul>
                <li>Streamlined data workflows (client data ingestion Minitab/Prosim-ready analysis & SLA reporting), cutting latency by 30%.</li>
                <li>Ensured 99% data accuracy for analytics & SLA monitoring by integrating diverse client data sources with validation rules.</li>
                <li>Designed monitoring dashboards and automated alerts for SLA pipelines using Power BI and Python, achieving 95% uptime.</li>
                <li>Improved data integrity 20% by implementing data quality checks & performing RCA on anomalies & SLA deviations.</li>
              </ul>
            </div>
            
            <hr style="width: 100%; margin: 2rem 0;" />
            
            <div class="col-md-6" data-aos="fade-left" style="border-right: 1px solid #ccc; padding-right: 20px;">
              <h5>Apprenticeship - Mashreq Global Service</h5>
              <p>Oct 2021 - Feb 2022</p>
              <ul>
                <li>Converted from Intern to Apprentice based on performance.</li>
                <li>Refactored db queries and transformations, boosting processing speed by 20% and improving overall system performance.</li>
                <li>Monitored pipeline performance, identifying optimization opportunities and reducing troubleshooting time by 15%.</li>
              </ul>
            </div>
            
            <div class="col-md-6" data-aos="fade-left" style="padding-left: 20px;">
              <h5>Intern - Mashreq Global Service</h5>
              <p>Apr 2021 - Oct 2021</p>
              <ul>
                <li>Converted from Intern to Apprentice based on performance.</li>
                <li>Refactored db queries and transformations, boosting processing speed by 20% and improving overall system performance.</li>
                <li>Monitored pipeline performance, identifying optimization opportunities and reducing troubleshooting time by 15%.</li>
              </ul>
            </div>
            
          </div>
        </div>
      </section>
      

    <!-- Projects Section -->
<section id="projects" class="py-5" data-aos="fade-up">
    <div class="container">
        <h2 class="text-center">Projects</h2>
        <div class="row text-center mt-4">
            <div class="col-md-4" data-aos="fade-up">
                <div class="card">
                    <img src="Images/Visual_image.png" class="card-img-top" alt="Project 3">
                    <div class="card-body">
                        <h5 class="card-title">Walmart Review Sentiment Analysis</h5>
                        <p class="card-text">Walmart Electronics Review Sentiment Analysis uses NLP and machine learning to analyze customer feedback.</p>
                        <a href="https://github.com/Anirudhpatil367/Sentiment_Analysis_Walmart_Customer_Review" class="btn btn-primary" target="_blank">View Project</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4" data-aos="fade-up">
                <div class="card">
                    <img src="Images/Image_summarization.png" class="card-img-top" alt="Project 4">
                    <div class="card-body">
                        <h5 class="card-title">Text Summarization with ML</h5>
                        <p class="card-text">Developed a machine learning model for text extraction and summarization from images,which enhances efficiency and provide quick summaries. </p>
                        <a href="https://github.com/Anirudhpatil367/Detection-of-Covid_19-using-Chest-X-Ray" class="btn btn-primary" target="_blank">View Project</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4" data-aos="fade-up">
                <div class="card">
                    <img src="Images/Covid_image.jpg" class="card-img-top" alt="Project 5">
                    <div class="card-body">
                        <h5 class="card-title">Detection of Covid-19 Using X-Ray</h5>
                        <p class="card-text">The project uses image classification with a interactived web interface and a trained model to detect health conditions from Covid X_Rays.</p>
                        <a href="https://github.com/Anirudhpatil367/Detection-of-Covid_19-using-Chest-X-Ray" class="btn btn-primary" target="_blank">View Project</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4" data-aos="fade-left">
                <div class="card">
                    <img src="Images/Event_management_system.jpg" class="card-img-top" alt="Project 6">
                    <div class="card-body">
                        <h5 class="card-title">Event Management System</h5>
                        <p class="card-text">An Event Management System to efficiently manage event details, bookings, and venues, minimizing administrative work and improving workflow.</p>
                        <a href="https://github.com/Anirudhpatil367/Event_Management_System" class="btn btn-primary" target="_blank">View Project</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4" data-aos="fade-right">
                <div class="card">
                    <img src="Images/Photo_1.jpg" class="card-img-top" alt="Intelligent Traffic Control system">
                    <div class="card-body">
                        <h5 class="card-title">Intelligent Traffic Control system</h5>
                        <p class="card-text">An automated traffic management solution that uses sensors and servos to control vehicle flow at intersections, improving traffic efficiency and safety.</p>
                        <a href="https://github.com/Anirudhpatil367/Intelligent-Traffic-control-system" class="btn btn-primary" target="_blank">View Project</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

    <!-- Certification Section -->
<section id="projects" class="py-5" data-aos="fade-up">
    <div class="container">
        <h2 class="text-center">Certification</h2>
        <div class="row text-center mt-4">
            <div class="col-md-4" data-aos="fade-up">
                <div class="card">
                    <img src="Images/AWS.png" class="card-img-top" alt="Project 3">
                    <div class="card-body">
                        <h5 class="card-title">AWS Certified Data Engineer - Associate</h5>
                        <a href="https://cp.certmetrics.com/amazon/en/public/verify/credential/7c9907537b1844dbb4d7451875ef9e26" class="btn btn-primary" target="_blank">View Certificate</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4" data-aos="fade-up">
                <div class="card">
                    <img src="Images/GCP.png" class="card-img-top" alt="Project 3">
                    <div class="card-body">
                        <h5 class="card-title">Google Cloud Platform Fundamentals: Core Infrastructure </h5>
                        <a href="https://www.coursera.org/account/accomplishments/verify/MBAUMZXGN53U?utm_source=link&utm_campaign=copybutton_certificate&utm_product=course" class="btn btn-primary" target="_blank">View Certificate</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4" data-aos="fade-up">
                <div class="card">
                    <img src="Images/Databricks.png" class="card-img-top" alt="Project 3">
                    <div class="card-body">
                        <h5 class="card-title">Databricks Certified Data Engineer Associate</h5>
                        <a href="" class="btn btn-primary" target="_blank">View Certificate</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
    <!-- Contact Section -->
    <section id="contact" class="bg-primary text-white text-center py-5" data-aos="fade-up">
        <div class="container">
            <h2>Contact Me</h2>
            <p>Have a question or want to work together?</p>
            <a href="mailto:apatil3@Uab.edu" class="btn btn-outline-light" target="_blank">Email Me</a>
            <a href="tel:+12052226249" class="btn btn-outline-light" target="_blank">Call Me</a>
            <a href="https://www.linkedin.com/in/anirudhpatil367/" class="btn btn-outline-light" target="_blank">LinkedIn</a>
        </div>
    </section>

    <footer class="bg-dark text-white text-center py-3">
        <p>&copy; 2024 Anirudh. All rights reserved.</p>
        <div id="counter-container" style="position: relative; width: fit-content;">
            <a href="http://www.freevisitorcounters.com" id="visitor-counter-link">
              <script type="text/javascript" src="https://www.freevisitorcounters.com/auth.php?id=ecb98448c242692728a0e81e79fc2c06251b0e7b"></script>
              <script type="text/javascript" src="https://www.freevisitorcounters.com/en/home/counter/1249340/t/9"></script>
            </a>
          
            <!-- Overlay div to block clicks -->
            <div id="click-blocker" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10;"></div>
          </div>
          
          
    </footer>
    

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- AOS JS for animations -->
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init();
    </script>

    <!-- Custom JS -->
    <script src="script.js"></script>
        <!-- Chat Widget Button -->
<div id="chat-button" style="position: fixed; bottom: 20px; right: 20px; background:#0a2540; color:#fff; border-radius:50%; width:60px; height:60px; display:flex; justify-content:center; align-items:center; cursor:pointer; z-index:1000; font-size:28px;">
    💬
  </div>
  
  <!-- Chat Widget Popup -->
  <div id="chat-popup" style="display:none; position: fixed; bottom: 90px; right: 20px; width: 320px; max-height: 400px; background: #fff; box-shadow: 0 0 10px rgba(0,0,0,0.3); border-radius: 10px; overflow: hidden; flex-direction: column; z-index: 1001; font-family: Arial, sans-serif;">
    <div id="chat-header" style="background: #0a2540; color: white; padding: 10px; font-weight: bold; display: flex; justify-content: space-between; align-items: center;">
      Assistant
      <span id="chat-close" style="cursor:pointer; font-weight: normal;">✖️</span>
    </div>
    <div id="chat-messages" style="padding: 10px; height: 280px; overflow-y: auto; font-size: 14px; background: #f9f9f9;"></div>
    <form id="chat-form" style="display: flex; border-top: 1px solid #ddd;">
      <input id="chat-input" type="text" placeholder="Ask me anything..." autocomplete="off" style="flex-grow:1; border:none; padding: 10px; font-size: 14px;" />
      <button type="submit" style="background:#0a2540; color:white; border:none; padding: 0 15px; cursor: pointer;">Send</button>
    </form>
    <!-- <script>
        // Toggle popup
        document.getElementById('chat-button').addEventListener('click', function () {
          const popup = document.getElementById('chat-popup');
          popup.style.display = popup.style.display === 'none' ? 'flex' : 'none';
        });
      
        // Close popup
        document.getElementById('chat-close').addEventListener('click', function () {
          document.getElementById('chat-popup').style.display = 'none';
        });
      
        // Chat form submit
        document.getElementById('chat-form').addEventListener('submit', async function (e) {
          e.preventDefault();
          const input = document.getElementById('chat-input');
          const message = input.value.trim();
          if (!message) return;
      
          // Show user message
          const chatBox = document.getElementById('chat-messages');
          chatBox.innerHTML += `<div><strong>You:</strong> ${message}</div>`;
          chatBox.scrollTop = chatBox.scrollHeight;
          input.value = '';
      
          // Send to backend
          try {
            const res = await fetch('/api/chat', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ question: message })
            });
            const data = await res.json();
      
            // Show assistant reply
            if (data && data.answer) {
                chatBox.innerHTML += `<div><strong>Assistant:</strong> ${data.answer}</div>`;
            } else {
                chatBox.innerHTML += `<div><strong>Assistant:</strong> Sorry, no reply.</div>`;
            }
            // if (data && data.response) {
            //   chatBox.innerHTML += `<div><strong>Assistant:</strong> ${data.answer}</div>`;
            // } else {
            //   chatBox.innerHTML += `<div><strong>Assistant:</strong> Sorry, no reply.</div>`;
            // }
            chatBox.scrollTop = chatBox.scrollHeight;
          } catch (err) {
            chatBox.innerHTML += `<div><strong>Assistant:</strong> Error contacting server.</div>`;
            console.error(err);
          }
        });
      </script> -->
      <!-- <script>
        const chatButton = document.getElementById('chat-button');
        const chatPopup = document.getElementById('chat-popup');
        const chatClose = document.getElementById('chat-close');
        const chatMessages = document.getElementById('chat-messages');
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
      
        // Function to add message
        function addMessage(sender, text) {
          const msgDiv = document.createElement('div');
          msgDiv.style.marginBottom = '10px';
          msgDiv.style.padding = '8px 12px';
          msgDiv.style.borderRadius = '12px';
          msgDiv.style.maxWidth = '80%';
          msgDiv.style.wordBreak = 'break-all';
          msgDiv.style.cursor = sender === 'assistant' ? 'pointer' : 'default';
      
          if (sender === 'user') {
            msgDiv.style.backgroundColor = '#0a2540';
            msgDiv.style.color = 'white';
            msgDiv.style.marginLeft = 'auto';
          } else {
            msgDiv.style.backgroundColor = '#e0e0e0';
            msgDiv.style.color = '#000';
            msgDiv.style.marginRight = 'auto';
      
            // On assistant message click, open chat popup
            msgDiv.addEventListener('click', () => {
              chatPopup.style.display = 'flex';
              chatInput.focus();
            });
          }
          msgDiv.textContent = text;
          chatMessages.appendChild(msgDiv);
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }
      
        // Toggle popup when chat button clicked
        chatButton.addEventListener('click', () => {
          if (chatPopup.style.display === 'none' || chatPopup.style.display === '') {
            chatPopup.style.display = 'flex';
            chatInput.focus();
          } else {
            chatPopup.style.display = 'none';
          }
        });
      
        // Close popup on close button click
        chatClose.addEventListener('click', () => {
          chatPopup.style.display = 'none';
        });
      
        // On page load: open chat and show welcome message if chat empty
        window.addEventListener('load', () => {
          chatPopup.style.display = 'flex';
          if (!chatMessages.hasChildNodes()) {
            addMessage('assistant', 'Welcome to Anirudh Prepared own Assistant! Feel free to ask me any questions related to Anirudh.');
          }
          chatInput.focus();
        });
      
        // Handle form submit
        chatForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const message = chatInput.value.trim();
          if (!message) return;
      
          addMessage('user', message);
          chatInput.value = '';
          chatInput.disabled = true;
      
          try {
            const res = await fetch('/api/chat', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ question: message })
            });
            const data = await res.json();
      
            if (data && data.answer) {
              addMessage('assistant', data.answer);
            } else {
              addMessage('assistant', 'Sorry, no reply.');
            }
          } catch (err) {
            addMessage('assistant', 'Error contacting server.');
            console.error(err);
          } finally {
            chatInput.disabled = false;
            chatInput.focus();
          }
        });
      </script> -->
      <script>
        const chatButton = document.getElementById('chat-button');
        const chatPopup = document.getElementById('chat-popup');
        const chatClose = document.getElementById('chat-close');
        const chatMessages = document.getElementById('chat-messages');
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
      
        // Function to generate the content with clickable elements
        function generateMessageContent(text, sender) {
            const contentNodes = [];
            let textRemainder = text; // This will hold the part of the string we still need to process

            // Define patterns and their handlers
            // The order of patterns can matter if one pattern is a substring of another.
            // Generally, more specific patterns (like full URLs) should come before broader ones (like just IDs).
            const patterns = [
                // 1. Full URLs (http/https)
                { 
                    regex: /(https?:\/\/[^\s]+)/g, 
                    handler: (match) => {
                        const a = document.createElement('a');
                        a.href = match;
                        a.textContent = match;
                        a.target = '_blank'; // Open in new tab
                        a.style.wordBreak = 'break-all'; // Aggressive break for long URLs
                        a.style.color = sender === 'user' ? 'lightblue' : '#007bff';
                        a.style.textDecoration = 'underline';
                        return a;
                    }
                },
                // 2. Email Addresses (e.g., ap@uab.edu)
                {
                    regex: /\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g,
                    handler: (match) => {
                        const a = document.createElement('a');
                        a.href = `mailto:${match}`;
                        a.textContent = match;
                        a.style.color = sender === 'user' ? 'lightblue' : '#007bff';
                        a.style.textDecoration = 'underline';
                        return a;
                    }
                },
                // 3. Phone Numbers (basic international format, adjust regex for specific needs)
                // Example: +12052226249, (205) 222-6249, 205-222-6249
                { 
                    regex: /(\+?\d{1,3}[\s.-]?\(?\d{3}\)?[\s.-]?\d{3}[\s.-]?\d{4}(?:\s*x\d+)?)/g, 
                    handler: (match) => {
                        const a = document.createElement('a');
                        // For phone numbers, use tel: scheme and clean up for the href
                        a.href = `tel:${match.replace(/[\s().-]/g, '')}`; 
                        a.textContent = match;
                        a.style.wordBreak = 'break-all'; // To handle long number strings
                        a.style.color = sender === 'user' ? 'lightblue' : '#007bff';
                        a.style.textDecoration = 'underline';
                        return a;
                    }
                },
                // 4. Specific GitHub Username (e.g., Anirudhpatil367)
                // Using a word boundary \b to ensure it matches as a whole word
                // If you have multiple specific usernames, you could OR them in the regex: (user1|user2|user3)
                {
                    regex: /\b(Anirudhpatil367)\b/g, 
                    handler: (match) => {
                        const a = document.createElement('a');
                        a.href = `https://github.com/${match}`;
                        a.textContent = match;
                        a.target = '_blank';
                        a.style.color = sender === 'user' ? 'lightblue' : '#007bff';
                        a.style.textDecoration = 'underline';
                        return a;
                    }
                }
                // Add more patterns here if needed (e.g., Twitter handles, LinkedIn profile IDs if they are not full URLs)
            ];

            // Loop through the text, finding and replacing matches
            while (true) {
                let earliestMatch = null;
                let earliestMatchPattern = null;
                let matchStart = -1;

                // Find the earliest match across all defined patterns in the remaining text
                patterns.forEach(pattern => {
                    pattern.regex.lastIndex = 0; // Reset regex to search from start of textRemainder
                    const match = pattern.regex.exec(textRemainder);
                    if (match && (earliestMatch === null || match.index < earliestMatch.index)) {
                        earliestMatch = match;
                        earliestMatchPattern = pattern;
                        matchStart = match.index;
                    }
                });

                if (earliestMatch) {
                    // Add the plain text that comes *before* the earliest match
                    if (matchStart > 0) {
                        contentNodes.push(document.createTextNode(textRemainder.substring(0, matchStart)));
                    }

                    // Add the interactive element generated by the handler for the match
                    const element = earliestMatchPattern.handler(earliestMatch[0]);
                    contentNodes.push(element);

                    // Update textRemainder to start *after* the current match, for the next iteration
                    textRemainder = textRemainder.substring(matchStart + earliestMatch[0].length);
                } else {
                    // No more matches found in the remaining text.
                    // Add any final remaining plain text.
                    if (textRemainder.length > 0) {
                        contentNodes.push(document.createTextNode(textRemainder));
                    }
                    break; // Exit the loop
                }
            }
            return contentNodes; // Return the array of nodes (text nodes and link elements)
        }

        // Function to add message (main function)
        function addMessage(sender, text) {
          const msgDiv = document.createElement('div');
          msgDiv.style.marginBottom = '10px';
          msgDiv.style.padding = '8px 12px';
          msgDiv.style.borderRadius = '12px';
          msgDiv.style.maxWidth = '80%';
          msgDiv.style.overflowWrap = 'break-word'; // General word wrapping for the entire message bubble
          msgDiv.style.cursor = sender === 'assistant' ? 'pointer' : 'default';
      
          if (sender === 'user') {
            msgDiv.style.backgroundColor = '#0a2540';
            msgDiv.style.color = 'white';
            msgDiv.style.marginLeft = 'auto';
          } else {
            msgDiv.style.backgroundColor = '#e0e0e0';
            msgDiv.style.color = '#000';
            msgDiv.style.marginRight = 'auto';
      
            // On assistant message click, open chat popup
            msgDiv.addEventListener('click', () => {
              chatPopup.style.display = 'flex';
              chatInput.focus();
            });
          }

          // Use the new generateMessageContent function to get the structured content
          const contentNodes = generateMessageContent(text, sender);
          // Append all generated nodes to the message div
          contentNodes.forEach(node => msgDiv.appendChild(node));
          
          chatMessages.appendChild(msgDiv); // Append the complete message div to the chat
          chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to the bottom
        }
      
        // Toggle popup when chat button clicked
        chatButton.addEventListener('click', () => {
          if (chatPopup.style.display === 'none' || chatPopup.style.display === '') {
            chatPopup.style.display = 'flex';
            chatInput.focus();
          } else {
            chatPopup.style.display = 'none';
          }
        });
      
        // Close popup on close button click
        chatClose.addEventListener('click', () => {
          chatPopup.style.display = 'none';
        });
      
        // On page load: open chat and show welcome message if chat empty
        window.addEventListener('load', () => {
          chatPopup.style.display = 'flex';
          if (!chatMessages.hasChildNodes()) {
            // REVERTED TO ORIGINAL WELCOME MESSAGE
            addMessage('assistant', 'Welcome to Anirudh Prepared own Assistant! Feel free to ask me any questions related to Anirudh.');
          }
          chatInput.focus();
        });
      
        // Handle form submit
        chatForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const message = chatInput.value.trim();
          if (!message) return;
      
          addMessage('user', message);
          chatInput.value = '';
          chatInput.disabled = true;
      
          try {
            const res = await fetch('/api/chat', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ question: message })
            });
            const data = await res.json();
      
            if (data && data.answer) {
              // The 'data.answer' is where the contact information should come from
              // when the user asks for it. The 'generateMessageContent' will correctly
              // parse and format any links/numbers/emails within this answer.
              addMessage('assistant', data.answer);
            } else {
              addMessage('assistant', 'Sorry, no reply.');
            }
          } catch (err) {
            addMessage('assistant', 'Error contacting server.');
            console.error(err);
          } finally {
            chatInput.disabled = false;
            chatInput.focus();
          }
        });
      </script>
</body>
</html>
